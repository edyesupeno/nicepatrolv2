<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Leaflet Maps - Adonara</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #map { height: 500px; width: 100%; border: 1px solid #ccc; border-radius: 8px; }
        .info { margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; }
        .controls { margin: 20px 0; }
        button { margin: 5px; padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
    </style>
</head>
<body>
    <h1>Test Leaflet Maps dengan Server Adonara</h1>
    
    <div class="info">
        <h3>Informasi Test:</h3>
        <p><strong>Tile Server:</strong> https://maps.adonara.co.id/tile/{z}/{x}/{y}.png</p>
        <p><strong>Koordinat Default:</strong> Jakarta (-6.2088, 106.8456)</p>
        <p><strong>Zoom Default:</strong> 12</p>
        <p><strong>Status:</strong> <span id="status">Loading...</span></p>
        <p><strong>Konfigurasi:</strong> Menggunakan environment variables untuk pengaturan maps</p>
    </div>
    
    <div class="controls">
        <button onclick="addTestMarkers()">Tambah Marker Test</button>
        <button onclick="goToJakarta()">Ke Jakarta</button>
        <button onclick="goToBandung()">Ke Bandung</button>
        <button onclick="goToSurabaya()">Ke Surabaya</button>
        <button onclick="clearMarkers()">Hapus Marker</button>
    </div>
    
    <div id="map"></div>
    
    <div class="info" style="margin-top: 20px;">
        <h3>Log:</h3>
        <div id="log" style="font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <script>
        let map;
        let markers = [];
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(status) {
            document.getElementById('status').textContent = status;
            log(`Status: ${status}`);
        }
        
        // Initialize map
        function initMap() {
            try {
                log('Initializing Leaflet Map...');
                updateStatus('Initializing...');
                
                // Use config values
                map = L.map('map').setView(mapConfig.defaultCenter, mapConfig.defaultZoom);
                
                // Add tile layer from config
                const tileLayer = L.tileLayer(mapConfig.tileServer, {
                    attribution: mapConfig.attribution,
                    maxZoom: mapConfig.maxZoom,
                    minZoom: mapConfig.minZoom
                });
                
                tileLayer.addTo(map);
                
                // Handle tile load events
                tileLayer.on('loading', function() {
                    log('Loading tiles...');
                    updateStatus('Loading tiles...');
                });
                
                tileLayer.on('load', function() {
                    log('Tiles loaded successfully!');
                    updateStatus('Ready');
                });
                
                tileLayer.on('tileerror', function(e) {
                    log(`Tile error: ${e.error}`);
                    updateStatus('Tile loading error');
                });
                
                // Add click handler
                map.on('click', function(e) {
                    log(`Map clicked at: ${e.latlng.lat.toFixed(6)}, ${e.latlng.lng.toFixed(6)}`);
                    
                    // Add marker at clicked location
                    const marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
                    marker.bindPopup(`
                        <div>
                            <strong>Koordinat:</strong><br>
                            Lat: ${e.latlng.lat.toFixed(6)}<br>
                            Lng: ${e.latlng.lng.toFixed(6)}
                        </div>
                    `).openPopup();
                    
                    markers.push(marker);
                });
                
                log('Leaflet Map initialized successfully');
                updateStatus('Map ready - click to add markers');
                
            } catch (error) {
                log(`Error initializing map: ${error.message}`);
                updateStatus('Initialization failed');
            }
        }
        
        // Add test markers
        function addTestMarkers() {
            log('Adding test markers...');
            
            const testLocations = [
                { name: 'Jakarta', lat: -6.2088, lng: 106.8456, color: '#2563eb' },
                { name: 'Bandung', lat: -6.9175, lng: 107.6191, color: '#10b981' },
                { name: 'Surabaya', lat: -7.2575, lng: 112.7521, color: '#ef4444' },
                { name: 'Yogyakarta', lat: -7.7956, lng: 110.3695, color: '#f59e0b' }
            ];
            
            testLocations.forEach(location => {
                // Create custom icon
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="background-color: ${location.color}; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                
                const marker = L.marker([location.lat, location.lng], { icon: icon }).addTo(map);
                
                marker.bindPopup(`
                    <div class="p-2">
                        <h3 style="margin: 0 0 8px 0; color: ${location.color};">${location.name}</h3>
                        <p style="margin: 0; font-size: 12px;">
                            <strong>Koordinat:</strong><br>
                            ${location.lat}, ${location.lng}
                        </p>
                        <p style="margin: 8px 0 0 0; font-size: 11px; color: #666;">
                            Test marker untuk ${location.name}
                        </p>
                    </div>
                `);
                
                markers.push(marker);
                log(`Added marker for ${location.name}`);
            });
            
            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
                log('Map bounds adjusted to show all markers');
            }
        }
        
        // Navigation functions
        function goToJakarta() {
            map.setView([-6.2088, 106.8456], 12);
            log('Navigated to Jakarta');
        }
        
        function goToBandung() {
            map.setView([-6.9175, 107.6191], 12);
            log('Navigated to Bandung');
        }
        
        function goToSurabaya() {
            map.setView([-7.2575, 112.7521], 12);
            log('Navigated to Surabaya');
        }
        
        function clearMarkers() {
            markers.forEach(marker => {
                map.removeLayer(marker);
            });
            markers = [];
            log('All markers cleared');
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            log('DOM loaded, initializing map...');
            setTimeout(initMap, 100);
        });
        
        // Configuration variables (in Laravel, these would come from config/services.php)
        const mapConfig = {
            tileServer: 'https://maps.adonara.co.id/tile/{z}/{x}/{y}.png',
            attribution: 'Â© <a href="https://maps.adonara.co.id/">Adonara Maps</a>',
            maxZoom: 18,
            minZoom: 1,
            defaultCenter: [-6.2088, 106.8456],
            defaultZoom: 12
        };
        
        // Update initialization to use config
        function initMap() {
            try {
                log('Initializing Leaflet Map...');
                updateStatus('Initializing...');
                
                // Use config values
                map = L.map('map').setView(mapConfig.defaultCenter, mapConfig.defaultZoom);
                
                // Add tile layer from config
                const tileLayer = L.tileLayer(mapConfig.tileServer, {
                    attribution: mapConfig.attribution,
                    maxZoom: mapConfig.maxZoom,
                    minZoom: mapConfig.minZoom
                });
    </script>
</body>
</html>
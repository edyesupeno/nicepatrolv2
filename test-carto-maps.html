<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test CartoDB Maps - Reliable & Fast</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 100vh }
    .info {
      position:absolute;
      bottom:10px;
      left:10px;
      background:#fff;
      padding:10px 14px;
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,.2);
      font-size:13px;
      max-width: 250px;
    }
    .status {
      position:absolute;
      top:10px;
      right:10px;
      background:#fff;
      padding:8px 12px;
      border-radius:6px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
      font-size:12px;
    }
    .success { color: #059669; }
    .error { color: #dc2626; }
    .loading { color: #2563eb; }
    .controls {
      position:absolute;
      top:10px;
      left:10px;
      background:#fff;
      padding:10px;
      border-radius:6px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
      font-size:12px;
    }
    button {
      margin: 2px;
      padding: 4px 8px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
    }
    button:hover { background: #1d4ed8; }
  </style>
</head>
<body>

<div id="map"></div>
<div class="status">
  <span id="status-text" class="loading">Loading CartoDB Maps...</span>
</div>
<div class="controls">
  <div><strong>CartoDB Maps Test</strong></div>
  <button onclick="switchToLight()">Light</button>
  <button onclick="switchToDark()">Dark</button>
  <button onclick="switchToVoyager()">Voyager</button>
  <button onclick="addTestMarkers()">Add Markers</button>
</div>
<div class="info">
  <b>Test Lokasi</b><br>
  Jakarta, Indonesia<br>
  <small>Lat: -6.2088, Lng: 106.8456</small><br>
  <small>CartoDB Maps - Reliable & Fast</small>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const lat = -6.2088;
  const lon = 106.8456;
  let map;
  let currentTileLayer;
  let markers = [];
  
  function updateStatus(message, type = 'loading') {
    const statusEl = document.getElementById('status-text');
    statusEl.textContent = message;
    statusEl.className = type;
  }

  // Initialize map
  map = L.map('map').setView([lat, lon], 17);

  // CartoDB Light theme (default)
  function switchToLight() {
    if (currentTileLayer) map.removeLayer(currentTileLayer);
    
    currentTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '© OpenStreetMap contributors © CARTO',
      subdomains: 'abcd',
      maxZoom: 19
    });
    
    setupTileEvents('CartoDB Light');
    currentTileLayer.addTo(map);
  }
  
  // CartoDB Dark theme
  function switchToDark() {
    if (currentTileLayer) map.removeLayer(currentTileLayer);
    
    currentTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '© OpenStreetMap contributors © CARTO',
      subdomains: 'abcd',
      maxZoom: 19
    });
    
    setupTileEvents('CartoDB Dark');
    currentTileLayer.addTo(map);
  }
  
  // CartoDB Voyager theme
  function switchToVoyager() {
    if (currentTileLayer) map.removeLayer(currentTileLayer);
    
    currentTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '© OpenStreetMap contributors © CARTO',
      subdomains: 'abcd',
      maxZoom: 19
    });
    
    setupTileEvents('CartoDB Voyager');
    currentTileLayer.addTo(map);
  }
  
  function setupTileEvents(themeName) {
    let tilesLoaded = 0;
    let tilesErrored = 0;
    
    currentTileLayer.on('tileload', function() {
      tilesLoaded++;
      if (tilesLoaded === 1) {
        updateStatus(`✅ ${themeName} loaded successfully!`, 'success');
        console.log(`✅ ${themeName} tiles loaded`);
      }
    });
    
    currentTileLayer.on('tileerror', function(e) {
      tilesErrored++;
      console.error(`Tile error (${themeName}):`, e);
      if (tilesErrored > 3) {
        updateStatus(`❌ ${themeName} failed to load`, 'error');
      }
    });
    
    currentTileLayer.on('loading', function() {
      updateStatus(`Loading ${themeName}...`, 'loading');
    });
  }
  
  function addTestMarkers() {
    // Clear existing markers
    markers.forEach(marker => map.removeLayer(marker));
    markers = [];
    
    const testLocations = [
      { name: 'Checkpoint 1', lat: -6.2088, lng: 106.8456, color: '#2563eb' },
      { name: 'Checkpoint 2', lat: -6.2100, lng: 106.8470, color: '#10b981' },
      { name: 'Patrol Location', lat: -6.2090, lng: 106.8458, color: '#ef4444' }
    ];
    
    testLocations.forEach(location => {
      const marker = L.marker([location.lat, location.lng]).addTo(map);
      
      marker.bindPopup(`
        <div style="padding: 8px;">
          <h3 style="margin: 0 0 8px 0; color: ${location.color};">${location.name}</h3>
          <p style="margin: 0; font-size: 12px;">
            <strong>Koordinat:</strong><br>
            ${location.lat}, ${location.lng}
          </p>
          <p style="margin: 4px 0 0 0; font-size: 11px; color: #666;">
            CartoDB Maps Test
          </p>
        </div>
      `);
      
      markers.push(marker);
    });
    
    // Fit map to show all markers
    if (markers.length > 0) {
      const group = new L.featureGroup(markers);
      map.fitBounds(group.getBounds().pad(0.1));
    }
    
    console.log('Added', markers.length, 'test markers');
  }

  // Initialize with light theme
  switchToLight();
  
  // Add initial marker
  setTimeout(() => {
    L.marker([lat, lon]).addTo(map)
      .bindPopup(`
        <b>Jakarta Test</b><br>
        CartoDB Maps<br>
        <small>Koordinat: ${lat}, ${lon}</small>
      `)
      .openPopup();
  }, 1000);
</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Debug Laravel Map Implementation</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Exact same CSS as Laravel implementation -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>

    <!-- Ultra-simple map styling - no conflicts -->
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        
        /* Force map container to be visible and properly sized */
        #map {
            height: 400px !important;
            width: 100% !important;
            position: relative !important;
            z-index: 1 !important;
            background: #f9fafb !important;
            border: 1px solid #e5e7eb !important;
            border-radius: 8px !important;
        }
        
        /* Ensure Leaflet container is properly sized */
        .leaflet-container {
            height: 400px !important;
            width: 100% !important;
            font-family: inherit !important;
        }
        
        /* Fix any potential CSS conflicts */
        .leaflet-control-container {
            position: relative !important;
        }
        
        /* Ensure tiles display properly */
        .leaflet-tile {
            max-width: none !important;
        }
        
        /* Fix popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 8px !important;
        }
        
        .info { margin: 10px 0; padding: 10px; background: #f0f9ff; border-radius: 4px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        
        /* Tab styling */
        .tab-container { margin: 20px 0; border-bottom: 1px solid #e5e7eb; }
        .tab-button { 
            padding: 12px 16px; 
            margin-right: 8px; 
            border: none; 
            background: none; 
            cursor: pointer; 
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        .tab-button.active { 
            color: #3b82f6; 
            border-bottom-color: #3b82f6;
        }
        .tab-content { 
            display: none; 
            padding: 20px 0; 
        }
        .tab-content:not(.hidden) { 
            display: block; 
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Debug Laravel Map Implementation</h1>
    <p>This simulates the exact Laravel implementation with tabs and map initialization.</p>
    
    <!-- Tab simulation - exact same structure as Laravel -->
    <div class="tab-container">
        <button id="tab-patroli" class="tab-button active">
            <i class="fas fa-route"></i> Riwayat Patroli
        </button>
        <button id="tab-checkpoint" class="tab-button">
            <i class="fas fa-map-marker-alt"></i> Coverage Checkpoint
        </button>
        <button id="tab-location" class="tab-button">
            <i class="fas fa-map-marked-alt"></i> Verifikasi Lokasi
        </button>
        <button id="tab-aset" class="tab-button">
            <i class="fas fa-shield-alt"></i> Status Aset
        </button>
    </div>
    
    <!-- Tab Contents - exact same structure as Laravel -->
    <div id="content-patroli" class="tab-content">
        <h3>Riwayat Patroli</h3>
        <p>This is the patrol history tab content.</p>
    </div>
    
    <div id="content-checkpoint" class="tab-content hidden">
        <h3>Coverage Checkpoint</h3>
        <p>This is the checkpoint coverage tab content.</p>
    </div>
    
    <div id="content-location" class="tab-content hidden">
        <h3>Verifikasi Lokasi</h3>
        
        <!-- Maps Container - exact same as Laravel -->
        <div class="mb-6">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Peta Lokasi Checkpoint</h4>
            
            <!-- Simple map container with inline styles -->
            <div id="map" style="height: 400px; width: 100%; border: 1px solid #e5e7eb; border-radius: 8px; background-color: #f9fafb; position: relative; z-index: 1;"></div>
            
            <div id="map-status" class="mt-2 text-sm text-gray-600">
                <span id="map-loading" class="inline-flex items-center">
                    Loading map...
                </span>
            </div>
        </div>
    </div>
    
    <div id="content-aset" class="tab-content hidden">
        <h3>Status Aset</h3>
        <p>This is the asset status tab content.</p>
    </div>
    
    <!-- Leaflet JS - Load once -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <script>
        console.log('Kawasan detail JavaScript loaded');

        // Simple tab switching function - exact same as Laravel
        function showTab(tabName) {
            console.log('showTab called with:', tabName);
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedContent = document.getElementById('content-' + tabName);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }
            
            // Add active class to selected tab button
            const selectedButton = document.getElementById('tab-' + tabName);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            console.log('Tab switched to:', tabName);
        }

        // Initialize when DOM is ready - exact same as Laravel
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing tabs');
            
            // Add click listeners to tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.id.replace('tab-', '');
                    showTab(tabName);
                });
            });
            
            console.log('Tab system initialized');
        });

        // Ultra-simple map implementation - exactly like Laravel
        let map;
        let markers = [];

        // Fix Leaflet marker icons issue - use CDN icons
        delete L.Icon.Default.prototype._getIconUrl;
        L.Icon.Default.mergeOptions({
            iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',
            iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
        });

        function initUltraSimpleMap() {
            try {
                console.log('üó∫Ô∏è Starting ultra-simple map initialization...');
                
                // Update status
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #3b82f6;">Initializing map...</span>';
                }
                
                // Check if map element exists and has dimensions
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('‚ùå Map element not found');
                    return;
                }
                
                console.log('‚úÖ Map element found, dimensions:', mapElement.offsetWidth, 'x', mapElement.offsetHeight);
                
                // Initialize map - exact same as working test
                map = L.map('map').setView([-6.2088, 106.8456], 15);
                
                console.log('‚úÖ Leaflet map object created');
                
                // Add OpenStreetMap tiles - most reliable option
                const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18,
                    minZoom: 1
                });
                
                let tilesLoaded = 0;
                
                tileLayer.on('tileload', function() {
                    tilesLoaded++;
                    if (tilesLoaded === 1) {
                        console.log('‚úÖ First tile loaded successfully');
                        if (statusElement) {
                            statusElement.innerHTML = '<span style="color: #10b981;">‚úÖ Map loaded successfully</span>';
                        }
                    }
                });
                
                tileLayer.on('tileerror', function(e) {
                    console.warn('Tile error:', e);
                });
                
                tileLayer.addTo(map);
                console.log('‚úÖ Tile layer added');
                
                // Add markers after map is ready
                setTimeout(function() {
                    addUltraSimpleMarkers();
                }, 500);
                
                // Force map to resize
                setTimeout(function() {
                    if (map) {
                        map.invalidateSize();
                        console.log('‚úÖ Map size invalidated');
                    }
                }, 1000);
                
                console.log('‚úÖ Ultra-simple map initialization complete');
                
            } catch (error) {
                console.error('‚ùå Error in ultra-simple map initialization:', error);
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #ef4444;">‚ùå Map failed to load: ' + error.message + '</span>';
                }
            }
        }

        function addUltraSimpleMarkers() {
            console.log('üìç Adding ultra-simple markers...');
            
            try {
                // Add checkpoint markers (blue) - simulating Laravel data
                const checkpointMarker1 = L.marker([-6.2088, 106.8456])
                    .addTo(map)
                    .bindPopup('<b>Checkpoint Alpha</b><br>QR001<br><small>Checkpoint Terdaftar</small>');
                markers.push(checkpointMarker1);
                console.log('‚úÖ Added checkpoint: Checkpoint Alpha');
                
                const checkpointMarker2 = L.marker([-6.2100, 106.8470])
                    .addTo(map)
                    .bindPopup('<b>Checkpoint Beta</b><br>QR002<br><small>Checkpoint Terdaftar</small>');
                markers.push(checkpointMarker2);
                console.log('‚úÖ Added checkpoint: Checkpoint Beta');
                
                // Add patrol markers (green) - simulating Laravel data
                const patrolMarker1 = L.marker([-6.2090, 106.8458])
                    .addTo(map)
                    .bindPopup('<b>Patrol Location Alpha</b><br>18 Jan 2026 14:30<br><small>Lokasi Patroli</small>');
                markers.push(patrolMarker1);
                console.log('‚úÖ Added patrol location');
                
                // Fit map to show all markers
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                    console.log('üéØ Map bounds adjusted for', markers.length, 'markers');
                }
                
            } catch (error) {
                console.error('‚ùå Error adding markers:', error);
            }
        }

        // Focus functions for buttons - exact same as Laravel
        function focusCheckpoint(lat, lng, name) {
            if (map) {
                map.setView([lat, lng], 18);
                L.popup()
                    .setLatLng([lat, lng])
                    .setContent('<b>' + name + '</b><br><small>Checkpoint Terdaftar</small>')
                    .openOn(map);
            }
        }

        function focusPatrolLocation(lat, lng, name) {
            if (map) {
                map.setView([lat, lng], 18);
                L.popup()
                    .setLatLng([lat, lng])
                    .setContent('<b>' + name + '</b><br><small>Lokasi Patroli</small>')
                    .openOn(map);
            }
        }

        // Initialize when location tab is clicked - exact same as Laravel
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåê DOM loaded for ultra-simple map');
            
            const locationTab = document.getElementById('tab-location');
            if (locationTab) {
                locationTab.addEventListener('click', function() {
                    console.log('üìç Location tab clicked');
                    
                    // Wait for tab to be visible
                    setTimeout(function() {
                        const tabContent = document.getElementById('content-location');
                        if (tabContent && !tabContent.classList.contains('hidden')) {
                            console.log('‚úÖ Location tab is visible, initializing map...');
                            if (!map) {
                                initUltraSimpleMap();
                            } else {
                                console.log('üîÑ Map already exists, refreshing...');
                                map.invalidateSize();
                            }
                        } else {
                            console.log('‚ö†Ô∏è Location tab not visible yet');
                        }
                    }, 200);
                });
            }
            
            // Also check if location tab is already active
            const locationContent = document.getElementById('content-location');
            if (locationContent && !locationContent.classList.contains('hidden')) {
                console.log('üöÄ Location tab already active, initializing map...');
                setTimeout(initUltraSimpleMap, 300);
            }
        });
    </script>
</body>
</html>
</content>
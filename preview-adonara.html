<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Preview Lokasi - Adonara Maps</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 100vh }
    .info {
      position:absolute;
      bottom:10px;
      left:10px;
      background:#fff;
      padding:10px 14px;
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,.2);
      font-size:13px;
      max-width: 250px;
    }
    .status {
      position:absolute;
      top:10px;
      right:10px;
      background:#fff;
      padding:8px 12px;
      border-radius:6px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
      font-size:12px;
    }
    .success { color: #059669; }
    .error { color: #dc2626; }
    .loading { color: #2563eb; }
  </style>
</head>
<body>

<div id="map"></div>
<div class="status">
  <span id="status-text" class="loading">Loading Adonara Maps...</span>
</div>
<div class="info">
  <b>Test Lokasi</b><br>
  Jakarta, Indonesia<br>
  <small>Lat: -6.2088, Lng: 106.8456</small>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // Data dari contoh Anda (Jakarta)
  const lat = -6.2088;
  const lon = 106.8456;
  
  function updateStatus(message, type = 'loading') {
    const statusEl = document.getElementById('status-text');
    statusEl.textContent = message;
    statusEl.className = type;
  }

  const map = L.map('map').setView([lat, lon], 17);

  // Gunakan Adonara Maps - format URL yang benar
  const tileLayer = L.tileLayer('https://maps.adonara.co.id/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© Adonara Maps'
  });
  
  let tilesLoaded = 0;
  let tilesErrored = 0;
  
  tileLayer.on('tileload', function() {
    tilesLoaded++;
    if (tilesLoaded === 1) {
      updateStatus('✅ Adonara Maps loaded successfully!', 'success');
    }
  });
  
  tileLayer.on('tileerror', function(e) {
    tilesErrored++;
    console.error('Tile error:', e);
    if (tilesErrored > 3) {
      updateStatus('❌ Adonara Maps failed to load', 'error');
    }
  });
  
  tileLayer.addTo(map);

  // Add marker
  L.marker([lat, lon]).addTo(map)
    .bindPopup(`
      <b>Lokasi Test</b><br>
      Jakarta, Indonesia<br>
      <small>Koordinat: ${lat}, ${lon}</small>
    `)
    .openPopup();
    
  // Test reverse geocoding
  fetch(`https://maps.adonara.co.id/reverse?lat=${lat}&lon=${lon}&format=json`)
    .then(res => res.json())
    .then(data => {
      console.log('Reverse geocoding result:', data);
      document.querySelector('.info').innerHTML = `
        <b>Alamat dari Adonara</b><br>
        ${data.display_name || 'Jakarta, Indonesia'}<br>
        <small>Lat: ${lat}, Lng: ${lon}</small>
      `;
    })
    .catch(err => {
      console.error('Reverse geocoding error:', err);
    });
</script>

</body>
</html>
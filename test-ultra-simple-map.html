<!DOCTYPE html>
<html>
<head>
    <title>Ultra Simple Map Test - Exact Laravel Implementation</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Ultra-simple map styling - no conflicts -->
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        
        /* Force map container to be visible and properly sized */
        #map {
            height: 400px !important;
            width: 100% !important;
            position: relative !important;
            z-index: 1 !important;
            background: #f9fafb !important;
            border: 1px solid #e5e7eb !important;
            border-radius: 8px !important;
        }
        
        /* Ensure Leaflet container is properly sized */
        .leaflet-container {
            height: 400px !important;
            width: 100% !important;
            font-family: inherit !important;
        }
        
        /* Fix any potential CSS conflicts */
        .leaflet-control-container {
            position: relative !important;
        }
        
        /* Ensure tiles display properly */
        .leaflet-tile {
            max-width: none !important;
        }
        
        /* Fix popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 8px !important;
        }
        
        .info { margin: 10px 0; padding: 10px; background: #f0f9ff; border-radius: 4px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .tab-container { margin: 20px 0; }
        .tab-button { padding: 10px 20px; margin-right: 10px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
        .tab-button.active { background: #3b82f6; color: white; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ccc; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Ultra Simple Map Test - Exact Laravel Implementation</h1>
    
    <!-- Tab simulation -->
    <div class="tab-container">
        <button id="tab-patroli" class="tab-button active" onclick="showTab('patroli')">Patroli</button>
        <button id="tab-location" class="tab-button" onclick="showTab('location')">Verifikasi Lokasi</button>
    </div>
    
    <div id="content-patroli" class="tab-content active">
        <h3>Riwayat Patroli</h3>
        <p>This is the patrol history tab.</p>
    </div>
    
    <div id="content-location" class="tab-content">
        <h3>Verifikasi Lokasi</h3>
        <div id="map-status" class="info">
            <span id="map-loading" class="inline-flex items-center">
                Loading map...
            </span>
        </div>
        <div id="map"></div>
    </div>
    
    <!-- Leaflet JS - Load once -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <script>
        // Tab switching function
        function showTab(tabName) {
            console.log('showTab called with:', tabName);
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedContent = document.getElementById('content-' + tabName);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
            
            // Add active class to selected tab button
            const selectedButton = document.getElementById('tab-' + tabName);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            // Initialize map if location tab is selected
            if (tabName === 'location') {
                setTimeout(function() {
                    if (!window.map) {
                        initUltraSimpleMap();
                    } else {
                        window.map.invalidateSize();
                    }
                }, 200);
            }
        }
        
        // Ultra-simple map implementation - exactly like Laravel
        let map;
        let markers = [];

        function initUltraSimpleMap() {
            try {
                console.log('üó∫Ô∏è Starting ultra-simple map initialization...');
                
                // Update status
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #3b82f6;">Initializing map...</span>';
                }
                
                // Check if map element exists and has dimensions
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('‚ùå Map element not found');
                    return;
                }
                
                console.log('‚úÖ Map element found, dimensions:', mapElement.offsetWidth, 'x', mapElement.offsetHeight);
                
                // Initialize map - exact same as working test
                map = L.map('map').setView([-6.2088, 106.8456], 15);
                window.map = map; // Make it global for tab switching
                
                console.log('‚úÖ Leaflet map object created');
                
                // Add OpenStreetMap tiles - most reliable option
                const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18,
                    minZoom: 1
                });
                
                let tilesLoaded = 0;
                
                tileLayer.on('tileload', function() {
                    tilesLoaded++;
                    if (tilesLoaded === 1) {
                        console.log('‚úÖ First tile loaded successfully');
                        if (statusElement) {
                            statusElement.innerHTML = '<span style="color: #10b981;">‚úÖ Map loaded successfully</span>';
                        }
                    }
                });
                
                tileLayer.on('tileerror', function(e) {
                    console.warn('Tile error:', e);
                });
                
                tileLayer.addTo(map);
                console.log('‚úÖ Tile layer added');
                
                // Add markers after map is ready
                setTimeout(function() {
                    addUltraSimpleMarkers();
                }, 500);
                
                // Force map to resize
                setTimeout(function() {
                    if (map) {
                        map.invalidateSize();
                        console.log('‚úÖ Map size invalidated');
                    }
                }, 1000);
                
                console.log('‚úÖ Ultra-simple map initialization complete');
                
            } catch (error) {
                console.error('‚ùå Error in ultra-simple map initialization:', error);
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #ef4444;">‚ùå Map failed to load: ' + error.message + '</span>';
                }
            }
        }

        function addUltraSimpleMarkers() {
            console.log('üìç Adding ultra-simple markers...');
            
            try {
                // Add checkpoint markers (blue)
                const checkpointMarker1 = L.marker([-6.2088, 106.8456])
                    .addTo(map)
                    .bindPopup('<b>Checkpoint 1</b><br>QR001<br><small>Checkpoint Terdaftar</small>');
                markers.push(checkpointMarker1);
                console.log('‚úÖ Added checkpoint: Checkpoint 1');
                
                const checkpointMarker2 = L.marker([-6.2100, 106.8470])
                    .addTo(map)
                    .bindPopup('<b>Checkpoint 2</b><br>QR002<br><small>Checkpoint Terdaftar</small>');
                markers.push(checkpointMarker2);
                console.log('‚úÖ Added checkpoint: Checkpoint 2');
                
                // Add patrol markers (green)
                const patrolMarker1 = L.marker([-6.2090, 106.8458])
                    .addTo(map)
                    .bindPopup('<b>Patrol Location 1</b><br>18 Jan 2026 14:30<br><small>Lokasi Patroli</small>');
                markers.push(patrolMarker1);
                console.log('‚úÖ Added patrol location');
                
                // Fit map to show all markers
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                    console.log('üéØ Map bounds adjusted for', markers.length, 'markers');
                }
                
            } catch (error) {
                console.error('‚ùå Error adding markers:', error);
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåê DOM loaded for ultra-simple map');
        });
    </script>
</body>
</html>
</content>
</invoke>
<!DOCTYPE html>
<html>
<head>
    <title>Test Simple Direct Map - Exact Laravel Structure</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #f3f4f6; }
        
        /* Exact same structure as Laravel */
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .tab-container { margin: 20px 0; border-bottom: 1px solid #e5e7eb; }
        .tab-button { 
            padding: 12px 16px; 
            margin-right: 8px; 
            border: none; 
            background: none; 
            cursor: pointer; 
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        .tab-button.active { 
            color: #3b82f6; 
            border-bottom-color: #3b82f6;
        }
        .tab-content { 
            display: none; 
            padding: 24px 0; 
        }
        .tab-content:not(.hidden) { 
            display: block; 
        }
        .hidden { display: none !important; }
        .p-6 { padding: 24px; }
        .mb-6 { margin-bottom: 24px; }
        
        /* Exact same map styling as Laravel */
        #map-container {
            height: 400px; 
            width: 100%; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            background: #f9fafb; 
            position: relative; 
            overflow: hidden;
        }
        
        #map {
            height: 100%; 
            width: 100%;
        }
        
        .info { margin: 10px 0; padding: 10px; background: #f0f9ff; border-radius: 4px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Test Simple Direct Map - Exact Laravel Structure</h1>
        <p>This tests the exact same structure and approach as Laravel implementation.</p>
        
        <!-- Tab simulation - exact same structure as Laravel -->
        <div class="tab-container">
            <button id="tab-patroli" class="tab-button active">
                Riwayat Patroli
            </button>
            <button id="tab-location" class="tab-button">
                Verifikasi Lokasi
            </button>
        </div>
        
        <!-- Tab Contents - exact same structure as Laravel -->
        <div id="content-patroli" class="tab-content p-6">
            <h3>Riwayat Patroli</h3>
            <p>This is the patrol history tab content.</p>
        </div>
        
        <div id="content-location" class="tab-content hidden p-6">
            <h3>Verifikasi Lokasi</h3>
            
            <!-- Maps Container - EXACT same as Laravel -->
            <div class="mb-6">
                <h4 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 16px;">Peta Lokasi Checkpoint</h4>
                
                <!-- Simple direct map approach - EXACT same as Laravel -->
                <div id="map-container" style="height: 400px; width: 100%; border: 1px solid #e5e7eb; border-radius: 8px; background: #f9fafb; position: relative; overflow: hidden;">
                    <div id="map" style="height: 100%; width: 100%;"></div>
                </div>
                
                <div id="map-status" style="margin-top: 8px; font-size: 14px; color: #6b7280;">
                    <span id="map-loading">
                        Memuat peta...
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <script>
        console.log('Kawasan detail JavaScript loaded');

        // Simple tab switching function - EXACT same as Laravel
        function showTab(tabName) {
            console.log('showTab called with:', tabName);
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedContent = document.getElementById('content-' + tabName);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }
            
            // Add active class to selected tab button
            const selectedButton = document.getElementById('tab-' + tabName);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }
            
            console.log('Tab switched to:', tabName);
        }

        // Ultra-simple direct map implementation - EXACT same as Laravel
        let map;
        let markers = [];

        function initSimpleDirectMap() {
            try {
                console.log('üó∫Ô∏è Starting simple direct map initialization...');
                
                // Update status
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #3b82f6;">Initializing simple map...</span>';
                }
                
                // Check if map element exists
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('‚ùå Map element not found');
                    return;
                }
                
                console.log('‚úÖ Map element found, dimensions:', mapElement.offsetWidth, 'x', mapElement.offsetHeight);
                
                // Force container styles
                mapElement.style.height = '400px';
                mapElement.style.width = '100%';
                
                // Initialize map with very basic settings
                map = L.map('map').setView([-6.2088, 106.8456], 15);
                
                console.log('‚úÖ Leaflet map object created');
                
                // Add tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(map);
                
                console.log('‚úÖ Tiles added');
                
                // Add simple test markers
                const testMarker1 = L.marker([-6.2088, 106.8456])
                    .addTo(map)
                    .bindPopup('<b>Test Checkpoint</b><br>Map is working!');
                
                const testMarker2 = L.marker([-6.2090, 106.8458])
                    .addTo(map)
                    .bindPopup('<b>Test Patrol</b><br>Map is working!');
                
                markers.push(testMarker1, testMarker2);
                
                console.log('‚úÖ Test markers added');
                
                // Update status
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #10b981;">‚úÖ Simple map loaded with ' + markers.length + ' test markers</span>';
                }
                
                // Force resize
                setTimeout(function() {
                    if (map) {
                        map.invalidateSize();
                        console.log('‚úÖ Map size invalidated');
                    }
                }, 500);
                
                console.log('‚úÖ Simple direct map initialization complete');
                
            } catch (error) {
                console.error('‚ùå Error in simple direct map initialization:', error);
                const statusElement = document.getElementById('map-loading');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #ef4444;">‚ùå Map failed to load: ' + error.message + '</span>';
                }
            }
        }

        // Initialize when DOM is ready - EXACT same as Laravel
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåê DOM loaded for ultra-simple map');
            
            // Add click listeners to tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.id.replace('tab-', '');
                    showTab(tabName);
                });
            });
            
            const locationTab = document.getElementById('tab-location');
            if (locationTab) {
                locationTab.addEventListener('click', function() {
                    console.log('üìç Location tab clicked');
                    
                    // Wait for tab to be visible
                    setTimeout(function() {
                        const tabContent = document.getElementById('content-location');
                        if (tabContent && !tabContent.classList.contains('hidden')) {
                            console.log('‚úÖ Location tab is visible, initializing map...');
                            if (!map) {
                                initSimpleDirectMap();
                            } else {
                                console.log('üîÑ Map already exists, refreshing...');
                                map.invalidateSize();
                            }
                        } else {
                            console.log('‚ö†Ô∏è Location tab not visible yet');
                        }
                    }, 200);
                });
            }
            
            // Also check if location tab is already active
            const locationContent = document.getElementById('content-location');
            if (locationContent && !locationContent.classList.contains('hidden')) {
                console.log('üöÄ Location tab already active, initializing map...');
                setTimeout(initSimpleDirectMap, 300);
            }
            
            console.log('‚úÖ Tab system initialized');
        });
    </script>
</body>
</html>
</content>